<!DOCTYPE html>
<meta charset="utf-8">
<style>

.hexagon {
  fill: none;
  stroke: #000;
  stroke-width: .5px;
}

</style>
<link rel="stylesheet" type="text/css" href="style/d3.slider.css" />
<link rel="stylesheet" type="text/css" href="style/main.css" />

<body>
<div class="wrapper">
    <div class="radius-slider"></div>
    <button class="omg">omg</button>
</div>
<script type="text/javascript" src="./js/d3.v3.min.js"></script>
<script type="text/javascript" src="./js/d3.slider.js"></script>
<script type="text/javascript" src="./js/d3.hexbin.v0.min.js"></script>
<script>

var data;

d3.json("/data/json/generated_data.json", function(error, json) {
    if (error) return console.warn(error);
    data = json;
    hexify();
})

var width = 960,
    height = 500,
    i = -1,
    theta = 0,
    dtheta = 0.03,
    n = 2000,
    k = 20,
    radius = 19.5;

var randomX = d3.random.normal(width / 2, 80),
    randomY = d3.random.normal(height / 2, 80),
    points = d3.range(n).map(function() { return [randomX(), randomY()]; });

var color = d3.scale.linear()
    .domain([0, 20])
    .range(["white", "steelblue"])
    .interpolate(d3.interpolateLab);

var hexbin = d3.hexbin()
    .size([width, height])
    .radius(radius);

var svg = d3.select(".wrapper").append("svg")
    .attr("width", width)
    .attr("height", height);

var hexagon = svg.append("g")
    .attr("class", "hexagons")
    .selectAll("path")

function randomizeData(path) {
  path = path ? path : "/data/json/generated_data.json"
  theta += dtheta;
  randomX = d3.random.normal(width / 2 + 80 * Math.cos(theta), 80),
  randomY = d3.random.normal(height / 2 + 80 * Math.sin(theta), 80);

  for (var j = 0; j < k; ++j) {
    i = (i + 1) % n;
    data[i][0] = randomX();
    data[i][1] = randomY();
  }
  hexify()
}

function hexify() {
    hexagon = hexagon
        .data(hexbin(data), function(d) { return d.i + "," + d.j; });
    hexagon.exit().remove()
    hexagon
        .enter().append("path")
        .classed("hexagon", true)
    hexagon
        .attr("d", hexbin.hexagon( radius ))
        .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
        .style("fill", function(d) { return color(d.length); });
}

function clickiness() {
    if (!clickiness.clicked)
    {
        clickiness.clicked = true;
        d3.timer(function() { 
            randomizeData(); 
            return !clickiness.clicked;
        });
    } else {
        clickiness.clicked = false;
    }
}

function processSlide(evt, val) {
    radius = val;
    hexbin.radius(radius);
    hexify();
}

radiusSlider = d3.slider()
    .value(radius)
    .min(5)
    .max(30)
    .on("slide", processSlide)
d3.select(".radius-slider").call(radiusSlider)
d3.select("button.omg").on("click", clickiness)

</script>

